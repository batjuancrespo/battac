
New Chat
New Chat



Fork of Dictado Radiológico Mejorado


Share
Entiendo que el texto dictado no se está incorporando al cuadro de texto como debería. Vamos a revisar y corregir este problema para asegurarnos de que el dictado funcione correctamente.

Aquí tienes una versión corregida del código que debería solucionar el problema del texto dictado que no se incorpora al cuadro de texto:


He realizado las siguientes correcciones y mejoras para solucionar el problema del texto dictado que no se incorporaba al cuadro de texto:

Corrección de la función onresult:

Mo difiqué la lógica para asegurar que tanto los resultados finales como los intermedios se manejen correctamente.
Implementé una inserción más precisa del texto dictado en el área de texto, respetando la posición del cursor.
Mejora del manejo de resultados intermedios y finales:

Ahora se muestra el texto intermedio en el estado mientras se dicta.
El texto final se inserta correctamente en el área de texto.
Optimización de la actualización del cursor:

Aseguré que la posición del cursor se actualice correctamente después de insertar nuevo texto.
Mejora de la retroalimentación visual:

Actualicé los mensajes de estado para proporcionar información más clara sobre el proceso de dictado.
Manejo más robusto de errores:

Mantuve el manejo de errores existente y añadí más logging para facilitar la depuración.
Optimización del procesamiento de texto:

Mantuve la función applyCapitalizationAndPunctuation para asegurar que el texto dictado se formatee correctamente.
Mantenimiento de otras funcionalidades:

Conservé las funciones de aprendizaje de frases, sugerencias, y mejora con IA.
Este código corregido debería solucionar el problema del texto dictado que no se incorporaba al cuadro de texto. Ahora, cuando hables, deberías ver el texto aparecer en el área de texto en tiempo real, con los resultados finales insertándose correctamente y los resultados intermedios mostrándose en el estado.

Si aún experimentas problemas, por favor, asegúrate de que tu navegador tenga permisos para acceder al micrófono y que estés utilizando un navegador compatible con la Web Speech API (como Chrome, Edge o Firefox).


Copy

Retry


No se reconoce punto y aparte cuando dicto como "." y nueva linea. Además, quisiera que la combinación de teclas "i", "Shift" y "Meta Left" pudiera activar el botón de dictado




Entiendo tus preocupaciones. Vamos a abordar ambos problemas: el reconocimiento del punto y aparte, y la activación del dictado mediante una combinación de teclas específica.

Aquí tienes una versión actualizada del código que aborda tus preocupaciones:


He realizado las siguientes modificaciones para abordar tus preocupaciones:

Reconocimiento de punto y aparte:

He añadido una nueva función procesarComandosDeVoz que reconoce las frases "punto nueva línea" y "nueva línea" como comandos para insertar un punto y un salto de línea.
Esta función se llama dentro del manejador onresult del reconocimiento de voz.
Activación del dictado mediante combinación de teclas:

He implementado un event listener a nivel de documento que escucha la combinación de teclas "i" + Shift + Meta (Command en Mac, Windows en PC).
Cuando se detecta esta combinación, se llama a la función toggleDictado, que inicia o detiene el dictado.
Mejoras adicionales:

He refactorizado la función de toggle del dictado para que pueda ser utilizada tanto por el botón como por el atajo de teclado.
He mantenido todas las funcionalidades existentes, incluyendo el aprendizaje de frases, sugerencias y mejora con IA.
Ahora, cuando dictes "punto nueva línea" o simplemente "nueva línea", se insertará un punto y un salto de línea en el texto. Además, puedes usar la combinación de teclas Shift + Command + I (en Mac) o Shift + Windows + I (en PC) para activar o desactivar el dictado rápidamente.

Estas modificaciones deberían mejorar significativamente la experiencia de usuario al dictar informes radiológicos. Si tienes alguna otra sugerencia o si encuentras algún problema, no dudes en hacérmelo saber.


Copy

Retry


No funcionan bien las mejoras. Cuando dicto "punto y aparte" no se produce el efecto deseado. Tampoco la combinación de teclas activa el boton. La combinación exacta es "Shift"+"I"+"Boton de Windows de la izquierda"




Entiendo que las mejoras implementadas no están funcionando como se esperaba. Vamos a corregir estos problemas específicos: el reconocimiento de "punto y aparte" y la combinación de teclas para activar el dictado.

Aquí tienes una versión actualizada del código que aborda estos problemas específicos:


He realizado las siguientes modificaciones para abordar los problemas específicos:

Reconocimiento de "punto y aparte":

En la función procesarComandosDeVoz, he cambiado la expresión regular para buscar específicamente "punto y aparte" (insensible a mayúsculas/minúsculas) y reemplazarlo por un punto seguido de dos saltos de línea.
Combinación de teclas para activar el dictado:

He modificado el event listener para que detecte exactamente la combinación "Shift" + "I" + "Botón de Windows de la izquierda".
Utilizo event.getModifierState('Meta') para detectar la tecla Windows (o Command en Mac).
Otras mejoras:

He mantenido todas las funcionalidades existentes, incluyendo el aprendizaje de frases, sugerencias y mejora con IA.
Ahora, cuando dictes "punto y aparte", se insertará un punto seguido de un párrafo nuevo. Además, la combinación de teclas Shift + I + Botón de Windows de la izquierda activará o desactivará el dictado.

Estas modificaciones deberían resolver los problemas específicos que mencionaste. Si encuentras algún otro problema o tienes más sugerencias, no dudes en hacérmelo saber.


Copy

Retry


Ahora el boton no se activa ni al hacer click con el raton ni con la combinacion de teclas




Entiendo que el botón de dictado no se está activando ni con el clic del ratón ni con la combinación de teclas. Vamos a revisar y corregir este problema.

Aquí tienes una versión actualizada del código que debería solucionar estos problemas:


He realizado las siguientes modificaciones para solucionar los problemas:

Función toggleDictado:

He simplificado la función para que solo cambie el estado de esDictando y llame a recognition.start() o recognition.stop() según corresponda.
Evento de clic del botón:

He asegurado que el evento de clic del botón de micrófono llame directamente a la función toggleDictado().
Detección de combinación de teclas:

He modificado la detección para que funcione tanto en Windows como en Mac, usando (event.metaKey || event.ctrlKey) para la tecla de comando/control.
Logs de depuración:

He añadido varios console.log en puntos clave para ayudar en la depuración.
Manejo de errores:

He mantenido el manejo de errores existente y añadido más logs para facilitar la identificación de problemas.
Estas modificaciones deberían resolver los problemas con la activación del dictado tanto por clic como por combinación de teclas. Ahora, cuando hagas clic en el botón del micrófono o uses la combinación de teclas (Shift + I + Windows/Command), deberías ver logs en la consola del navegador indicando que la función se ha activado.

Si aún persisten problemas, te sugiero que abras la consola del navegador (normalmente con F12) y observes los logs mientras intentas activar el dictado. Esto nos dará más información sobre dónde podría estar fallando el proceso.


Copy

Retry


Subscribe to Premium for higher message limits.Upgrade Plan
Close
Chat input
Ask a follow up…
Ninguno archivo selec.Attach Files
SendSend Message
v0 may make mistakes. Please use with discretion.

Close
Fork of Dictado Radiológico Mejorado

v12


Fork
Publish
index.html


<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dictado Radiológico Asistido por IA - Versión Mejorada</title>
    <style>
        :root {
            --primary-color: #4CAF50;
            --secondary-color: #45a049;
            --background-color: #f4f4f4;
            --text-color: #333;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            background-color: var(--background-color);
            color: var(--text-color);
        }
        .container {
            max-width: 1000px;
            margin: auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
        }
        h1, h2, h3 {
            color: var(--primary-color);
        }
        textarea, input[type="text"], input[type="password"] {
            width: 100%;
            padding: 10px;
            margin-bottom: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        textarea {
            height: 200px;
            resize: vertical;
        }
        button {
            background-color: var(--primary-color);
            color: white;
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        button:hover {
            background-color: var(--secondary-color);
        }
        #status {
            margin-top: 10px;
            font-style: italic;
            color: #666;
        }
        #vocabulario, #apiKeySection, #sugerencias {
            margin-top: 20px;
            padding: 15px;
            background-color: #f9f9f9;
            border-radius: 4px;
        }
        .highlight {
            background-color: yellow;
        }
        .suggestion {
            text-decoration: underline;
            cursor: pointer;
            color: blue;
        }
        #sugerencias button {
            margin: 5px;
            padding: 5px 10px;
            font-size: 0.9em;
        }
        #microfono {
            font-size: 24px;
            padding: 10px 20px;
        }
        #microfono.activo {
            background-color: #ff4444;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Dictado Radiológico Asistido por IA</h1>
        <textarea id="informe" placeholder="El informe aparecerá aquí..."></textarea>
        <div id="sugerencias">
            <h3>Sugerencias de frases habituales</h3>
            <!-- Las sugerencias se añadirán aquí dinámicamente -->
        </div>
        <button id="microfono">🎤 Iniciar Dictado</button>
        <button id="limpiarInforme">Limpiar Informe</button>
        <button id="mejorarIA">Mejorar con IA</button>
        <p id="status"></p>
        
        <div id="vocabulario">
            <h3>Agregar Vocabulario Médico</h3>
            <input type="text" id="nuevaPalabra" placeholder="Nueva palabra">
            <button id="agregarPalabra">Agregar Palabra</button>
            <div id="palabrasGuardadas"></div>
        </div>

        <div id="apiKeySection">
            <h3>Configuración de API Merriam-Webster</h3>
            <input type="password" id="apiKey" placeholder="Ingrese su clave API de Merriam-Webster">
            <button id="guardarApiKey">Guardar Clave API</button>
            <p>Para obtener una clave API gratuita, regístrese en <a href="https://dictionaryapi.com/register/index" target="_blank">Merriam-Webster Developer Center</a> y cree una nueva clave API para el Diccionario Médico.</p>
        </div>
    </div>

    <script>
        let recognition;
        let vocabularioMedico = new Set(JSON.parse(localStorage.getItem('vocabularioMedico')) || []);
        let apiKey = localStorage.getItem('merriamWebsterApiKey') || '';
        let frasesHabituales = JSON.parse(localStorage.getItem('frasesHabituales')) || {};
        let esDictando = false;

        if ('webkitSpeechRecognition' in window) {
            recognition = new webkitSpeechRecognition();
            recognition.continuous = true;
            recognition.interimResults = true;
            recognition.lang = 'es-ES';

            recognition.onstart = function() {
                document.getElementById('microfono').classList.add('activo');
                document.getElementById('microfono').textContent = '🎤 Pausar Dictado';
                document.getElementById('status').textContent = 'Escuchando...';
                console.log('Reconocimiento de voz iniciado');
            };

            recognition.onend = function() {
                if (esDictando) {
                    recognition.start();
                } else {
                    document.getElementById('microfono').classList.remove('activo');
                    document.getElementById('microfono').textContent = '🎤 Iniciar Dictado';
                    document.getElementById('status').textContent = 'Dictado pausado.';
                }
                console.log('Reconocimiento de voz finalizado');
            };

            recognition.onresult = function(event) {
                let interimTranscript = '';
                let finalTranscript = '';

                for (let i = event.resultIndex; i < event.results.length; ++i) {
                    const transcript = event.results[i][0].transcript;
                    if (event.results[i].isFinal) {
                        finalTranscript += transcript + ' ';
                    } else {
                        interimTranscript += transcript;
                    }
                }

                const informe = document.getElementById('informe');
                const cursorPosition = informe.selectionStart;

                if (finalTranscript) {
                    finalTranscript = procesarComandosDeVoz(finalTranscript);
                    const textBeforeCursor = informe.value.substring(0, cursorPosition);
                    const textAfterCursor = informe.value.substring(cursorPosition);
                    
                    informe.value = textBeforeCursor + finalTranscript + textAfterCursor;
                    const newCursorPosition = cursorPosition + finalTranscript.length;
                    informe.setSelectionRange(newCursorPosition, newCursorPosition);

                    aprenderFrases(finalTranscript);
                    actualizarSugerencias();
                }

                if (interimTranscript) {
                    document.getElementById('status').textContent = 'Transcribiendo: ' + interimTranscript;
                } else {
                    document.getElementById('status').textContent = 'Escuchando...';
                }
            };

            recognition.onerror = function(event) {
                console.error('Error en el reconocimiento de voz:', event.error);
                document.getElementById('status').textContent = 'Error en el reconocimiento: ' + event.error;
                if (event.error === 'no-speech') {
                    recognition.stop();
                    setTimeout(() => {
                        if (esDictando) recognition.start();
                    }, 1000);
                }
            };
        } else {
            document.getElementById('status').textContent = 'El reconocimiento de voz no está soportado en este navegador.';
        }

        function procesarComandosDeVoz(text) {
            // Reemplazar "punto y aparte" por un punto y un salto de línea
            text = text.replace(/\b(punto y aparte)\b/gi, '.\n\n');
            
            // Aplicar capitalización y puntuación general
            text = text.trim();
            text = text.replace(/(^\w|\.\s+\w)/g, match => match.toUpperCase());
            if (!/[.!?]$/.test(text)) {
                text += '.';
            }
            return text;
        }

        function aprenderFrases(texto) {
            const frases = texto.match(/\b(\w+\s+){2,5}\w+\b/g) || [];
            frases.forEach(frase => {
                frasesHabituales[frase] = (frasesHabituales[frase] || 0) + 1;
            });
            localStorage.setItem('frasesHabituales', JSON.stringify(frasesHabituales));
        }

        function actualizarSugerencias() {
            const sugerenciasDiv = document.getElementById('sugerencias');
            sugerenciasDiv.innerHTML = '<h3>Sugerencias de frases habituales</h3>';
            
            const frasesOrdenadas = Object.entries(frasesHabituales)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 5);

            frasesOrdenadas.forEach(([frase, _]) => {
                const boton = document.createElement('button');
                boton.textContent = frase;
                boton.onclick = () => insertarFrase(frase);
                sugerenciasDiv.appendChild(boton);
            });
        }

        function insertarFrase(frase) {
            const informe = document.getElementById('informe');
            const cursorPosition = informe.selectionStart;
            const textBeforeCursor = informe.value.substring(0, cursorPosition);
            const textAfterCursor = informe.value.substring(cursorPosition);
            
            informe.value = textBeforeCursor + frase + ' ' + textAfterCursor;
            informe.setSelectionRange(cursorPosition + frase.length + 1, cursorPosition + frase.length + 1);
            informe.focus();
        }

        function toggleDictado() {
            console.log('Función toggleDictado llamada');
            esDictando = !esDictando;
            if (esDictando) {
                recognition.start();
            } else {
                recognition.stop();
            }
        }

        document.getElementById('microfono').onclick = function() {
            console.log('Botón de micrófono clickeado');
            toggleDictado();
        };

        document.addEventListener('keydown', function(event) {
            // Comprobar si la combinación de teclas es "Shift" + "I" + "Botón de Windows de la izquierda"
            if (event.shiftKey && event.key === 'I' && (event.metaKey || event.ctrlKey)) {
                console.log('Combinación de teclas detectada');
                event.preventDefault(); // Prevenir el comportamiento por defecto
                toggleDictado();
            }
        });

        document.getElementById('limpiarInforme').onclick = function() {
            document.getElementById('informe').value = '';
            document.getElementById('status').textContent = 'Informe limpiado.';
        };

        document.getElementById('agregarPalabra').onclick = function() {
            let nuevaPalabra = document.getElementById('nuevaPalabra').value.trim();
            if (nuevaPalabra) {
                vocabularioMedico.add(nuevaPalabra);
                localStorage.setItem('vocabularioMedico', JSON.stringify([...vocabularioMedico]));
                document.getElementById('nuevaPalabra').value = '';
                actualizarPalabrasGuardadas();
                document.getElementById('status').textContent = 'Palabra agregada: ' + nuevaPalabra;
            }
        };

        function actualizarPalabrasGuardadas() {
            let palabrasGuardadas = document.getElementById('palabrasGuardadas');
            palabrasGuardadas.innerHTML = '<h4>Vocabulario guardado:</h4>';
            vocabularioMedico.forEach(palabra => {
                let span = document.createElement('span');
                span.textContent = palabra + ' ';
                palabrasGuardadas.appendChild(span);
            });
        }

        document.getElementById('mejorarIA').onclick = async function() {
            if (!apiKey) {
                alert('Por favor, ingrese su clave API de Merriam-Webster antes de mejorar el informe.');
                return;
            }

            let informe = document.getElementById('informe');
            let texto = informe.value;

            document.getElementById('status').textContent = 'Procesando con IA...';
            
            try {
                const palabras = texto.match(/\b\w+\b/g);
                let informeMejorado = texto;

                for (const palabra of palabras) {
                    if (!vocabularioMedico.has(palabra.toLowerCase())) {
                        const url = `https://www.dictionaryapi.com/api/v3/references/medical/json/${encodeURIComponent(palabra)}?key=${apiKey}`;
                        const response = await fetch(url);
                        const data = await response.json();

                        if (data.length > 0 && typeof data[0] === 'object') {
                            const definicion = data[0].shortdef ? data[0].shortdef[0] : null;
                            if (definicion) {
                                const regex = new RegExp(`\\b${palabra}\\b`, 'g');
                                informeMejorado = informeMejorado.replace(regex, `<span class="highlight" title="${definicion}">${palabra}</span>`);
                            }
                        }
                    }
                }

                informe.value = informeMejorado;
                document.getElementById('status').textContent = 'Informe mejorado con definiciones médicas';
            } catch (error) {
                console.error('Error al procesar con IA:', error);
                document.getElementById('status').textContent = 'Error al procesar con IA: ' + error.message;
            }
        };

        document.getElementById('guardarApiKey').onclick = function() {
            const newApiKey = document.getElementById('apiKey').value.trim();
            if (newApiKey) {
                apiKey = newApiKey;
                localStorage.setItem('merriamWebsterApiKey', apiKey);
                alert('Clave API guardada correctamente');
            } else {
                alert('Por favor, ingrese una clave API válida');
            }
        };

        // Cargar la clave API guardada al iniciar
        document.getElementById('apiKey').value = apiKey;

        actualizarPalabrasGuardadas();
        actualizarSugerencias();
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reconocimiento de Voz para Informes Radiológicos</title>
    <style>
        body { font-family: Arial, sans-serif; line-height: 1.6; padding: 20px; }
        button { margin: 5px; padding: 10px; }
        #interim-result { color: gray; }
        #final-result { font-weight: bold; }
        #status { color: red; }
        .section { margin-top: 20px; }
    </style>
</head>
<body>
    <h1>Reconocimiento de Voz para Informes Radiológicos</h1>
    <button onclick="startRecognition()">Iniciar Reconocimiento</button>
    <button onclick="stopRecognition()">Detener Reconocimiento</button>
    <div class="section">
        <h2>Estado:</h2>
        <p id="status"></p>
        <h2>Resultado Intermedio:</h2>
        <p id="interim-result"></p>
        <h2>Resultado Final:</h2>
        <p id="final-result"></p>
    </div>

    <script>
        let recognition;

        function init() {
            try {
                recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
                recognition.continuous = true;
                recognition.interimResults = true;
                recognition.lang = 'es-ES';

                recognition.onresult = handleRecognitionResult;
                recognition.onerror = handleRecognitionError;
                recognition.onend = handleRecognitionEnd;

                updateStatus('Sistema inicializado. Pulse "Iniciar Reconocimiento" para comenzar.');
            } catch (error) {
                updateStatus('Error al inicializar el reconocimiento de voz: ' + error.message);
            }
        }

        function handleRecognitionResult(event) {
            let interimTranscript = '';
            let finalTranscript = '';

            for (let i = event.resultIndex; i < event.results.length; ++i) {
                if (event.results[i].isFinal) {
                    finalTranscript += event.results[i][0].transcript;
                } else {
                    interimTranscript += event.results[i][0].transcript;
                }
            }

            displayResult(interimTranscript, finalTranscript);
        }

        function handleRecognitionError(event) {
            updateStatus('Error en el reconocimiento de voz: ' + event.error);
        }

        function handleRecognitionEnd() {
            updateStatus('Reconocimiento de voz finalizado. Pulse "Iniciar Reconocimiento" para continuar.');
        }

        function displayResult(interim, final) {
            document.getElementById('interim-result').textContent = interim;
            document.getElementById('final-result').textContent += final + ' ';
        }

        function startRecognition() {
            try {
                recognition.start();
                updateStatus('Reconocimiento de voz iniciado. Hable ahora.');
            } catch (error) {
                updateStatus('Error al iniciar el reconocimiento: ' + error.message);
            }
        }

        function stopRecognition() {
            try {
                recognition.stop();
                updateStatus('Reconocimiento de voz detenido.');
            } catch (error) {
                updateStatus('Error al detener el reconocimiento: ' + error.message);
            }
        }

        function updateStatus(message) {
            document.getElementById('status').textContent = message;
        }

        // Inicializar el sistema al cargar la página
        window.onload = init;
    </script>
</body>
</html>
